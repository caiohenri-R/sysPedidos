<html>

<head>
    <meta charset="UTF-8">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.2/font/bootstrap-icons.css" rel="stylesheet" />
    <title>Clientes</title>
</head>

<body>
    <main>
        <nav class="navbar navbar-expand-lg bg-body-tertiary">
            <div class="container-fluid">
                <a class="navbar-brand" href="#">SisPedidos</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                    aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav">
                        <li class="nav-item">
                            <a class="nav-link active" aria-current="page" href="/app/index.html">Início</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/app/estados.html">Estados</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/app/municipios.html">Municípios</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/app/clientes.html">Clientes</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/app/produtos.html">Produtos</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </main>
    <div class="container mt-4">
        <h2 style="text-align: center;"><i class="bi bi-people-fill"></i>&nbsp;Listagem de Clientes</h2>
        <hr>
        <form>
            <div class="form-row">
                <div class="col-md-6">
                    <div class="mx-auto">
                        <div class="input-group mb-1">
                            <label for="tx_id" class="input-group-text"><i class="bi bi-hash"></i></label>
                            <input type="text" placeholder="Identificador único" class="form-control" id="tx_id"
                                readonly disabled>
                        </div>
                    </div>

                    <div class="mx-auto">
                        <div class="input-group mb-1">
                            <label for="tx_nome_razao_social" class="input-group-text "><i
                                    class="bi-person"></i></label>
                            <input type="text" placeholder="Razão Social" class="form-control"
                                id="tx_nome_razao_social">
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="input-group mb-1">
                                <label for="tx_cpf" class="input-group-text "><i
                                        class="bi bi-person-video2"></i></label>
                                <input type="text" placeholder="CPF" class="form-control" id="tx_cpf" readonly disabled>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="input-group mb-1">
                                <label for="tx_cnpj" class="input-group-text "><i class="bi-person-vcard"></i></label>
                                <input type="text" placeholder="CNPJ" class="form-control" id="tx_cnpj" readonly
                                    disabled>
                            </div>
                        </div>
                    </div>

                    <div class="mx-auto">
                        <div class="input-group mb-1">
                            <label for="tx_telefone" class="input-group-text "><i
                                    class="bi bi-telephone-inbound"></i></label>
                            <input type="text" placeholder="Telefone: (xx) xxxxx-xxxx" class="form-control"
                                id="tx_telefone">
                        </div>
                    </div>

                    <!-- me identificar na div-->

                    <div class="row">
                        <div class="col-md-6">
                            <div class="input-group mb-1">
                                <label for="tx_id_estado" class="input-group-text ">
                                    <i class="bi bi-map"></i></label>
                                <select class="form-control" id="tx_id_estado">
                                    <option value="" hidden>Selecione um estado...</option>
                                </select>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="input-group mb-1">
                                <label for="tx_id_municipio" class="input-group-text "><i
                                        class="bi bi-geo-alt"></i></label>
                                <select class="form-control" id="tx_id_municipio">
                                    <option value="" hidden>Selecione um município...</option>
                                </select>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="input-group mb-1">
                                <label for="tx_endereco" class="input-group-text "><i
                                        class="bi bi-house-add"></i></label>
                                <input type="text" placeholder="Endereço" class="form-control" id="tx_endereco">
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="input-group mb-1">
                                <label for="tx_bairro" class="input-group-text "><i
                                        class="bi bi-building-add"></i></label>
                                <input type="text" placeholder="Bairro" class="form-control" id="tx_bairro">
                            </div>
                        </div>

                    </div>

                    <!-- me identificar na div-->

                    <div class="mx-auto">
                        <div class="input-group mb-1">
                            <label for="tx_cep" class="input-group-text "><i class="bi bi-terminal-plus"></i></label>
                            <input type="text" placeholder="CEP" class="form-control" id="tx_cep">
                        </div>
                    </div>

                    <div class="mx-auto">
                        <div class="input-group mb-1">
                            <label for="tx_email" class="input-group-text "><i class="bi bi-envelope-at"></i></label>
                            <input type="text" placeholder="E-mail" class="form-control" id="tx_email">
                        </div>
                    </div>

                    <div class="mx-auto">
                        <div class="input-group mb-1">
                            <label for="tx_informacoes" class="input-group-text "><i
                                    class="bi bi-info-square"></i></label>
                            <textarea class="form-control" id="tx_informacoes" placeholder="Informações"></textarea>
                        </div>
                    </div>

                    <div class="mx-auto">
                        <div class="input-group mb-1">
                            <label for="bo_ativo" class="input-group-text"><i class="bi bi-check2-square"></i></label>
                            <select class="form-control" id="bo_ativo">
                                <option value="" hidden>Selecione uma situação...</option>
                                <option value="true">Ativo</option>
                                <option value="false">Inativo</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            <br>
            <div class="form-group mb-1 row">
                <div class="col-sm-10">
                    <button type="button" class="btn btn-primary mr-2" onclick="criar()"><i
                            class="bi bi-person-plus-fill"></i>&nbsp;&nbsp;&nbsp;Criar</button>
                    <button type="button" class="btn btn-primary mr-2" onclick="alterar()"><i
                            class="bi bi-pencil-square"></i>&nbsp;Alterar</button>
                    <button type="button" class="btn btn-primary mr-2" onclick="carregar()"><i
                            class="bi bi-list-check"></i>&nbsp;&nbsp;Listar</button>
                    <button type="button" class="btn btn-secondary" onclick="limpar()"><i
                            class="bi bi-trash"></i>&nbsp;Limpar</button>
                </div>
            </div>
        </form>
        <table class="table table-bordered table-striped mt-4" border="1" id="listagem"></table>
    </div>



</body>
<script>
    // Função para limpar os campos do formulário
    function limpar() {
        document.getElementById("tx_id").value = "";
        document.getElementById("tx_nome_razao_social").value = "";
        document.getElementById("tx_cpf").value = "";
        document.getElementById("tx_cnpj").value = "";
        document.getElementById("tx_telefone").value = "";
        document.getElementById("tx_id_municipio").value = "";
        document.getElementById("tx_endereco").value = "";
        document.getElementById("tx_bairro").value = "";
        document.getElementById("tx_cep").value = "";
        document.getElementById("tx_email").value = "";
        document.getElementById("bo_ativo").value = "";
        document.getElementById("tx_informacoes").value = "";

    }

    // Função para enviar uma requisição DELETE para excluir um cliente
    function excluir(id_cliente) {
        console.log("Excluir cliente!");
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
                alert("Cliente excluido com sucesso");
                carregar();
            }
        }
        xhttp.open("DELETE", "/cliente/" + id_cliente);
        xhttp.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
        xhttp.send();
    }


    // Função para preencher/alterar os campos do formulário com os dados de um cliente
    function preencher(id_cliente, nome_razao_social_cliente, cliente_cpf, cliente_cnpj, cliente_telefone, municipio_nome_cliente, cliente_endereco, cliente_bairro, cliente_cep, cliente_email, cliente_ativo, cliente_informacoes) {
        console.log(id_cliente, nome_razao_social_cliente, cliente_cpf, cliente_cnpj, cliente_telefone, municipio_nome_cliente, cliente_endereco, cliente_bairro, cliente_cep, cliente_email, cliente_ativo, cliente_informacoes);
        document.getElementById("tx_id").value = id_cliente;
        document.getElementById("tx_nome_razao_social").value = decodeURI(nome_razao_social_cliente);
        document.getElementById("tx_cpf").value = cliente_cpf;
        document.getElementById("tx_cnpj").value = cliente_cnpj;
        document.getElementById("tx_telefone").value = cliente_telefone;
        document.getElementById("tx_id_municipio").value = municipio_nome_cliente;
        document.getElementById("tx_endereco").value = decodeURI(cliente_endereco);
        document.getElementById("tx_bairro").value = decodeURI(cliente_bairro);
        document.getElementById("tx_cep").value = cliente_cep;
        document.getElementById("tx_email").value = cliente_email;
        document.getElementById("bo_ativo").value = cliente_ativo;
        document.getElementById("tx_informacoes").value = decodeURI(cliente_informacoes);

    }


    // Função para enviar uma requisição PUT para alterar um cliente
    function alterar() {
        console.log("Alterar cliente!");
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
                alert("Cliente alterado com sucesso");
                carregar();
            }
        }
        xhttp.open("PUT", "/cliente/" + document.getElementById("tx_id").value);
        xhttp.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
        xhttp.send(JSON.stringify({ id: document.getElementById("tx_id").value, nome: document.getElementById("tx_nome_razao_social").value, telefone: document.getElementById("tx_telefone").value, endereco: document.getElementById("tx_endereco").value, bairro: document.getElementById(tx_bairro).value, cep: document.getElementById("tx_cep").value, email: document.getElementById("tx_email").value, ativo: document.getElementById("bo_ativo").value, informacoes: document.getElementById("tx_informacoes").value, municipio: document.getElementById("tx_id_municipio") }));
    }


    // Função para enviar uma requisição POST para criar um novo cliente
    function criar() {
        console.log("Criar novo Cliente!");
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
                alert("Cliente criado com sucesso");
                carregar();
            }
        }
        xhttp.open("POST", "/cliente");
        xhttp.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
        xhttp.send(JSON.stringify({
            id: null, nome_razao_social: document.getElementById("tx_nome_razao_social").value, cpf: document.getElementById("tx_cpf").value, cnpj: document.getElementById("tx_cnpj").value, telefone: document.getElementById("tx_telefone").value, endereco: document.getElementById("tx_endereco").value, bairro: document.getElementById("tx_bairro").value, cep: document.getElementById("tx_cep").value, email: document.getElementById("tx_email").value, ativo: document.getElementById("bo_ativo").value, informacoes: document.getElementById("tx_informacoes").value,
            municipio: {
                id: document.getElementById("tx_id_municipio").value // Captura o id do município selecionado
            }


        }));
    }


    // Função para carregar a listagem de clientes
    function carregar() {
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
                var dados = JSON.parse(this.responseText);
                var conteudo = "<tr> <th>ID</th> <th>Nome</th> <th>CPF</th> <th>CNPJ</th> <th>Telefone</th> <th>Município</th> <th>Endereço</th> <th>Bairro</th> <th>CEP</th> <th>E-mail</th> <th>Ativo</th> <th>Informações</th> <th> Ações </th></tr>";
                for (var cliente of dados) {
                    /*var nome = String(cliente.nome_razao_social);*/
                    /*var municipio = cliente.municipio ? cliente.municipio.nome : '-'*/
                    conteudo += "<tr> <td>" + cliente.id + " </td> <td>" + cliente.nome_razao_social + "</td> <td>" + cliente.cpf + "</td> <td>" + cliente.cnpj + "</td> <td>" + cliente.telefone + "</td><td>" + cliente.municipio.nome + "</td> <td>" + cliente.endereco + "</td> <td>" + cliente.bairro + "</td> <td>" + cliente.cep + "</td> <td>" + cliente.email + "</td> <td>" + (cliente.ativo ? 'Sim' : 'Não') + "</td> <td>" + cliente.informacoes + "</td>";
                    conteudo += "<td> <button type='button' class='bi bi-pencil-square btn btn-primary m-1' title='Alterar' onclick=preencher('" + cliente.id + "','" + encodeURI(cliente.nome_razao_social) + "','" + cliente.cpf + "','" + cliente.cnpj + "','" + cliente.telefone + "','" + cliente.municipio.nome + "','" + encodeURI(cliente.endereco) + "','" + encodeURI(cliente.bairro) + "','" + cliente.cep + "','" + cliente.email + "','" + cliente.ativo + "','" + encodeURI(cliente.informacoes) + "')></button>";
                    conteudo += "<button type='button' class='bi bi-trash btn btn-secondary m-1' onclick='excluir(" + cliente.id + ")' title='Excluir'></button></td></tr>";
                }
                document.getElementById("listagem").innerHTML = conteudo;
                limpar();
                console.log(this.responseText);
                console.log(dados);
            }
        };
        xhttp.open("GET", "/clientes");
        xhttp.send();

    }


    function carregarMunicipios() {
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
                var municipios = JSON.parse(this.responseText);
                var selectMunicipio = document.getElementById("tx_id_municipio");
                selectMunicipio.innerHTML = '<option value="" hidden>Selecione um município...</option>';
                municipios.forEach(function (municipio) {
                    var option = document.createElement("option");
                    option.value = municipio.id;
                    option.textContent = municipio.nome;
                    selectMunicipio.appendChild(option);
                });
            }
        };
        xhttp.open("GET", "/municipios");
        xhttp.send();
    }
    carregarMunicipios();





</script>


</html>