<html>

<head>
    <meta charset="UTF-8">
    <title>Clientes</title>
</head>

<body>

    <h1> Listagem de Clientes</h1>
    <div>
        <p>Listagem de Clientes</p>
        <form>
            <label>ID:</label>
            <input type="text" id="tx_id" readonly="readonly" disabled="disabled" />
            <br>
            <label>NOME:</label>
            <input type="text" id="tx_nome_razao_social" />
            <br>
            <label>CPF:</label>
            <input type="text" id="tx_cpf" />
            <br>
            <label>CNPJ:</label>
            <input type="text" id="tx_cnpj" />
            <br>
            <label>TELEFONE:</label>
            <input type="text" id="tx_telefone" />
            <br>
            <label>ENEDREÇO:</label>
            <input type="text" id="tx_endereco" />
            <br>
            <label>BAIRRO:</label>
            <input type="text" id="tx_bairro" />
            <br>
            <label>CEP:</label>
            <input type="text" id="tx_cep" />
            <br>
            <label>EMAIL:</label>
            <input type="text" id="tx_email" />
            <br>
            <label>ATIVO:</label>
            <input type="text" id="bo_ativo" />
            <br>
            <label>INFORMACOES:</label>
            <input type="text" id="tx_informacoes" />
            <br>
            <button type="button" onclick="criar()">Criar</button>
            <button type="button" onclick="alterar()">Alterar</button>
            <button type="button" onclick="carregar()">Listar</button>
            <button type="button" onclick="limpar()">Limpar</button>
        </form>
        <table border="1" id="listagem"></table>
    </div>
</body>
<script>
    // Função para limpar os campos do formulário
    function limpar() {
        document.getElementById("tx_id").value = "";
        document.getElementById("tx_nome_razao_social").value = "";
        document.getElementById("tx_cpf").value = "";
        document.getElementById("tx_cnpj").value = "";
        document.getElementById("tx_telefone").value = "";
        document.getElementById("tx_endereco").value = "";
        document.getElementById("tx_bairro").value = "";
        document.getElementById("tx_cep").value = "";
        document.getElementById("tx_email").value = "";
        document.getElementById("bo_ativo").value = "";
        document.getElementById("tx_informacoes").value = "";

    }

    // Função para enviar uma requisição DELETE para excluir um cliente
    function excluir(id_cliente) {
        console.log("Excluir cliente!");
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
                alert("Cliente excluido com sucesso");
                carregar();
            }
        }
        xhttp.open("DELETE", "/cliente/" + id_cliente);
        xhttp.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
        xhttp.send();
    }


    // Função para preencher/alterar os campos do formulário com os dados de um cliente
    function preencher(id_cliente, nome_cliente, cliente_cpf, cliente_cnpj, cliente_telefone, nome_endereco, nome_bairro, cliente_cep, cliente_email, cliente_ativo, cliente_informacoes) {
        console.log(id_cliente, nome_cliente, cliente_cpf, cliente_cnpj, cliente_telefone, nome_endereco, nome_bairro, cliente_cep, cliente_email, cliente_ativo, cliente_informacoes);
        document.getElementById("tx_id").value = id_cliente;
        document.getElementById("tx_nome_razao_social").value = decodeURI(nome_cliente);
        document.getElementById("tx_cpf").value = cliente_cpf;
        document.getElementById("tx_cnpj").value = cliente_cnpj;
        document.getElementById("tx_telefone").value = cliente_telefone;
        document.getElementById("tx_endereco").value = decodeURI(nome_endereco);
        document.getElementById("tx_bairro").value = decodeURI(nome_bairro);
        document.getElementById("tx_cep").value = cliente_cep;
        document.getElementById("tx_email").value = cliente_email;
        document.getElementById("bo_ativo").value = cliente_ativo;
        document.getElementById("tx_informacoes").value = decodeURI(cliente_informacoes);

    }


    // Função para enviar uma requisição PUT para alterar um cliente
    function alterar() {
        console.log("Alterar cliente!");
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
                alert("Cliente alterado com sucesso");
                carregar();
            }
        }
        xhttp.open("PUT", "/cliente/" + document.getElementById("tx_id").value);
        xhttp.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
        xhttp.send(JSON.stringify({ id: document.getElementById("tx_id").value, nome: document.getElementById("tx_nome_razao_social").value, telefone: document.getElementById("tx_telefone").value, endereco: document.getElementById("tx_endereco").value, bairro: document.getElementById(tx_bairro).value, cep: document.getElementById("tx_cep").value, email: document.getElementById("tx_email").value, ativo: document.getElementById("bo_ativo").value, informacoes: document.getElementById("tx_informacoes").value }));
    }


    // Função para enviar uma requisição POST para criar um novo cliente
    function criar() {
        console.log("Criar novo Cliente!");
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
                alert("Cliente criado com sucesso");
                carregar();
            }
        }
        xhttp.open("POST", "/cliente");
        xhttp.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
        xhttp.send(JSON.stringify({ id: null, nome: document.getElementById("tx_nome_razao_social").value, cpf: document.getElementById("tx_cpf").value, cnpj: document.getElementById("tx_cnpj").value, telefone: document.getElementById("tx_telefone").value, endereco: document.getElementById("tx_endereco").value, bairro: document.getElementById(tx_bairro).value, cep: document.getElementById("tx_cep").value, email: document.getElementById("tx_email").value, ativo: document.getElementById("bo_ativo").value, informacoes: document.getElementById("tx_informacoes").value }));
    }


    // Função para carregar a listagem de clientes via AJAX
    function carregar() {
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
                var dados = JSON.parse(this.responseText);
                var conteudo = "<tr> <th>ID</th> <th>Nome</th> <th>CPF</th> <th>CNPJ</th> <th>Telefone</th> <th>Endereço</th> <th>Bairro</th> <th>CEP</th> <th>E-mail</th> <th>Ativo</th> <th>Informações</th> <th> Ações </th></tr>";
                for (var cliente of dados) {
                    conteudo += "<tr> <td>" + cliente.id + " </td> <td>" + cliente.nome + "</td> <td>" + cliente.cpf + "</td> <td>" + cliente.cnpj + "</td> <td>" + cliente.telefone + "</td> <td>" + cliente.endereco + "</td> <td>" + cliente.bairro + "</td> <td>" + cliente.cep + "</td> <td>" + cliente.email + "</td> <td>" + cliente.ativo + "</td> <td>" + cliente.informacoes + "</td>";
                    conteudo += "<td> <button type='button' onclick=preencher('" + cliente.id + "','" + encodeURI(cliente.nome) + "','" + cliente.telefone + "','" + encodeURI(cliente.endereco) + "','" + encodeURI(cliente.bairro) + "','" + cliente.cep + "','" + cliente.email + "','" + cliente.ativo + "','" + encodeURI(cliente.informacoes) + "')>Alterar</button> ";
                    conteudo += "<button type='button' onclick='excluir(" + cliente.id + ")'>Excluir</button></td></tr>";
                }
                document.getElementById("listagem").innerHTML = conteudo;
                limpar();
                console.log(this.responseText);
                console.log(dados);
            }
        };
        xhttp.open("GET", "/clientes");
        xhttp.send();
    }
</script>


</html>